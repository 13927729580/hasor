# DataQL 服务查询引擎

&emsp;&emsp;DataQL 是一款服务查询框架，如果您了解 GraphQL ，那么上手 DataQL 将非常块。使用DataQL 将会极大的满足业务灵活性上的开发需要。

----------
## 设计思想
&emsp;&emsp;DataQL 查询语言用法借鉴了 GraphQL。不同于 GraphQL 的是 DataQL 增添了一些脚本特性，同时可以基于 DataQL 编写 UDF。这些新特性会让您用起来比 GraphQL 更加舒心。

----------
## 架构
![架构](http://files.hasor.net/resources/CC2_5C5A_6D1E_18C4.png "架构")

----------
## 特性
01. 融入脚本特性，突破 GraphQL 只能做数据组织的界限，让业务开发更加容易。
02. 采用编译执行，拥有更快的运行速度。
03. 支持使用 lambda 在查询中定义函数。
04. 支持表达式计算。
05. 灵活的 UDF 扩展函数。
06. 完全独立，脱离 Hasor 依然可用。
07. DataQL 支持 JSON 数据输入。
08. 支持运算符重载，常见的运算符有：加(+)、减(-)、乘(*)、除(\\)...等。

----------
## 表达式计算
01. 算数运算：加(+)、减(-)、乘(*)、除(\\)、整除(/)、求余(%)、取反(-)
02. 逻辑运算：与(&&)、或(||)、非(!)、异或(^)
03. 比较运算：大于(>)、大于等于(>=)、小于(<)、小于等于(<=)、不等于(!=)、等于(==)
04. 二进制位运算：与(&)、或(|)、异或(^)、向左位移(<<)、向右位移(>>)、不带符号向右位移(>>>)

----------
## 浮点数
01. 浮点数计算精度，默认值保留小数点后20位。
02. 您可以通过 “option MAX_DECIMAL_DIGITS = 20” 来硒鼓改浮点数的默认保留位数。
03. 小数默认舍入规则为：四舍五入。如需更换舍入规则需要通过 “option NUMBER_ROUNDING = "HALF_EVEN" ” 更换
    * UP：向远离零的方向舍入。舍弃非零部分，并将非零舍弃部分相邻的一位数字加一。
    * DOWN：向接近零的方向舍入。舍弃非零部分，同时不会非零舍弃部分相邻的一位数字加一，采取截取行为。
    * CEILING：向正无穷的方向舍入。如果为正数，舍入结果同ROUND_UP一致；如果为负数，舍入结果同ROUND_DOWN一致。注意：此模式不会减少数值大小。
    * FLOOR：向负无穷的方向舍入。如果为正数，舍入结果同ROUND_DOWN一致；如果为负数，舍入结果同ROUND_UP一致。注意：此模式不会增加数值大小。
    * HALF_UP：向“最接近”的数字舍入，如果与两个相邻数字的距离相等，则为向上舍入的舍入模式。如果舍弃部分>= 0.5，则舍入行为与ROUND_UP相同；否则舍入行为与ROUND_DOWN相同。这种模式也就是我们常说的我们的“四舍五入”。
    * HALF_DOWN：向“最接近”的数字舍入，如果与两个相邻数字的距离相等，则为向下舍入的舍入模式。如果舍弃部分> 0.5，则舍入行为与ROUND_UP相同；否则舍入行为与ROUND_DOWN相同。这种模式也就是我们常说的我们的“五舍六入”。
    * HALF_EVEN：向“最接近”的数字舍入，如果与两个相邻数字的距离相等，则相邻的偶数舍入。如果舍弃部分左边的数字奇数，则舍入行为与 ROUND_HALF_UP 相同；如果为偶数，则舍入行为与 ROUND_HALF_DOWN 相同。注意：在重复进行一系列计算时，此舍入模式可以将累加错误减到最小。此舍入模式也称为“银行家舍入法”，主要在美国使用。四舍六入，五分两种情况，如果前一位为奇数，则入位，否则舍去。*/
    * UNNECESSARY：断言请求的操作具有精确的结果，因此不需要舍入。如果对获得精确结果的操作指定此舍入模式，则抛出ArithmeticException。
